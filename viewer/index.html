const params = new URLSearchParams(window.location.search);
let pdfPath = params.get("pdf");
pdfPath = "/krisishikkha/" + pdfPath;

pdfjsLib.GlobalWorkerOptions.workerSrc =
  "/krisishikkha/vendor/pdfjs/pdf.worker.min.js";

const container = document.getElementById("pdfContainer");
const pageInfo = document.getElementById("pageInfo");

let pdfDoc = null;
let scale = 1.3;

// restore scroll position
const savedScroll = localStorage.getItem(pdfPath + "_scroll");

pdfjsLib.getDocument(pdfPath).promise.then(pdf=>{
  pdfDoc = pdf;
  pageInfo.innerText = `Total Pages: ${pdf.numPages}`;

  for(let i=1;i<=pdf.numPages;i++){
    renderPage(i);
  }

  // restore last position
  setTimeout(()=>{
    if(savedScroll){
      window.scrollTo(0, parseInt(savedScroll));
    }
  }, 800);
});

function renderPage(num){
  pdfDoc.getPage(num).then(page=>{
    const viewport = page.getViewport({ scale });
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    canvas.height = viewport.height;
    canvas.width = viewport.width;

    container.appendChild(canvas);

    page.render({
      canvasContext: ctx,
      viewport: viewport
    });
  });
}

// save scroll position
window.addEventListener("scroll", ()=>{
  localStorage.setItem(pdfPath + "_scroll", window.scrollY);
});
